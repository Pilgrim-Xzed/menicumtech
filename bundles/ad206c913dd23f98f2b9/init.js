(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{1168:function(e,t,n){"use strict";t.a=n.p+"i18n/languages.b124721.json"},1169:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return _}));var a=n(466),i=n(467),o=n(39),s=n(34),r=n(308),c=(n(44),n(41)),l=n(457),d=n(155),u=n(289),p=n(48),h=n(33),g=n.n(h),m=n(9);const C=window.ipcRenderer,f=navigator.platform.toUpperCase().includes("MAC");function w(e){["call_state"].includes(e.action)&&C.send("app_onAction",e)}function y(e){return!0===e?{status:a.b.DOWNLOADING}:!1===e?{status:a.b.NOTAVAILABLE}:{status:a.b.ERROR,detail:e}}class b extends i.a{constructor(){super(),this._pendingIpcCalls={},this._nextIpcCallId=0,C.on("seshatReply",this._onIpcReply.bind(this))}async _ipcCall(e,...t){const n=++this._nextIpcCallId;return new Promise((a,i)=>{this._pendingIpcCalls[n]={resolve:a,reject:i},window.ipcRenderer.send("seshat",{id:n,name:e,args:t})})}_onIpcReply(e,t){if(void 0===t.id)return void console.warn("Ignoring IPC reply with no ID");if(void 0===this._pendingIpcCalls[t.id])return void console.warn("Unknown IPC payload ID: "+t.id);const n=this._pendingIpcCalls[t.id];delete this._pendingIpcCalls[t.id],t.error?n.reject(t.error):n.resolve(t.reply)}async supportsEventIndexing(){return this._ipcCall("supportsEventIndexing")}async initEventIndex(){return this._ipcCall("initEventIndex")}async addEventToIndex(e,t){return this._ipcCall("addEventToIndex",e,t)}async deleteEvent(e){return this._ipcCall("deleteEvent",e)}async isEventIndexEmpty(){return this._ipcCall("isEventIndexEmpty")}async commitLiveEvents(){return this._ipcCall("commitLiveEvents")}async searchEventIndex(e){return this._ipcCall("searchEventIndex",e)}async addHistoricEvents(e,t,n){return this._ipcCall("addHistoricEvents",e,t,n)}async addCrawlerCheckpoint(e){return this._ipcCall("addCrawlerCheckpoint",e)}async removeCrawlerCheckpoint(e){return this._ipcCall("removeCrawlerCheckpoint",e)}async loadFileEvents(e){return this._ipcCall("loadFileEvents",e)}async loadCheckpoints(){return this._ipcCall("loadCheckpoints")}async closeEventIndex(){return this._ipcCall("closeEventIndex")}async getStats(){return this._ipcCall("getStats")}async deleteEventIndex(){return this._ipcCall("deleteEventIndex")}}class _ extends a.a{constructor(){super(),this._pendingIpcCalls={},this._nextIpcCallId=0,this.eventIndexManager=new b,o.a.register(w),C.on("check_updates",(e,t)=>{this.showUpdateCheck&&(o.a.dispatch({action:"check_updates",value:y(t)}),this.showUpdateCheck=!1)}),C.on("before-quit",(function(){console.log("riot-desktop closing"),r.b()})),C.on("ipcReply",this._onIpcReply.bind(this)),C.on("update-downloaded",this.onUpdateDownloaded.bind(this)),C.on("preferences",()=>{o.a.dispatch({action:"view_user_settings"})}),this.startUpdateCheck=this.startUpdateCheck.bind(this),this.stopUpdateCheck=this.stopUpdateCheck.bind(this),f?(Object(u.c)(u.a.NAVIGATION,{keybinds:[{modifiers:[u.b.COMMAND],key:p.a.COMMA}],description:Object(s.b)("Open user settings")}),Object(u.c)(u.a.NAVIGATION,{keybinds:[{modifiers:[u.b.COMMAND],key:p.a.SQUARE_BRACKET_LEFT},{modifiers:[u.b.COMMAND],key:p.a.SQUARE_BRACKET_RIGHT}],description:Object(s.b)("Previous/next recently visited room or community")})):Object(u.c)(u.a.NAVIGATION,{keybinds:[{modifiers:[u.b.ALT],key:p.a.ARROW_LEFT},{modifiers:[u.b.ALT],key:p.a.ARROW_RIGHT}],description:Object(s.b)("Previous/next recently visited room or community")}),this.ssoID=Object(m.a)(32),this._ipcCall("startSSOFlow",this.ssoID)}async getConfig(){return this._ipcCall("getConfig")}async onUpdateDownloaded(e,t){o.a.dispatch({action:"new_version",currentVersion:await this.getAppVersion(),newVersion:t,releaseNotes:t.releaseNotes})}getHumanReadableName(){return"Electron Platform"}setNotificationCount(e){this.notificationCount!==e&&(super.setNotificationCount(e),C.send("setBadgeCount",e))}supportsNotifications(){return!0}maySendNotifications(){return!0}displayNotification(t,n,a,i){navigator.userAgent.includes("Linux")&&(n=n.replace(/</g,"&lt;").replace(/>/g,"&gt;"));const s={body:n,silent:!0};a&&(s.icon=a);const r=new e.Notification(t,s);return r.onclick=()=>{o.a.dispatch({action:"view_room",room_id:i.roomId}),e.focus(),this._ipcCall("focusWindow")},r}loudNotification(e,t){C.send("loudNotification")}clearNotification(e){e.close()}async getAppVersion(){return this._ipcCall("getAppVersion")}supportsAutoLaunch(){return!0}async getAutoLaunchEnabled(){return this._ipcCall("getAutoLaunchEnabled")}async setAutoLaunchEnabled(e){return this._ipcCall("setAutoLaunchEnabled",e)}supportsAutoHideMenuBar(){return!f}async getAutoHideMenuBarEnabled(){return this._ipcCall("getAutoHideMenuBarEnabled")}async setAutoHideMenuBarEnabled(e){return this._ipcCall("setAutoHideMenuBarEnabled",e)}supportsMinimizeToTray(){return!f}async getMinimizeToTrayEnabled(){return this._ipcCall("getMinimizeToTrayEnabled")}async setMinimizeToTrayEnabled(e){return this._ipcCall("setMinimizeToTrayEnabled",e)}async canSelfUpdate(){const e=await this._ipcCall("getUpdateFeedUrl");return Boolean(e)}startUpdateCheck(){this.showUpdateCheck||(super.startUpdateCheck(),C.send("check_updates"))}installUpdate(){C.send("install_update")}getDefaultDeviceDisplayName(){return Object(s.a)("Riot Desktop (%(platformName)s)",{platformName:navigator.userAgent.includes("Macintosh")?"macOS":navigator.userAgent.includes("FreeBSD")?"FreeBSD":navigator.userAgent.includes("OpenBSD")?"OpenBSD":navigator.userAgent.includes("SunOS")?"SunOS":navigator.userAgent.includes("Windows")?"Windows":navigator.userAgent.includes("Linux")?"Linux":"Unknown"})}screenCaptureErrorString(){return null}requestNotificationPermission(){return Promise.resolve("granted")}reload(){window.location.reload(!1)}async _ipcCall(e,...t){const n=++this._nextIpcCallId;return new Promise((a,i)=>{this._pendingIpcCalls[n]={resolve:a,reject:i},window.ipcRenderer.send("ipcCall",{id:n,name:e,args:t})})}_onIpcReply(e,t){if(void 0===t.id)return void console.warn("Ignoring IPC reply with no ID");if(void 0===this._pendingIpcCalls[t.id])return void console.warn("Unknown IPC payload ID: "+t.id);const n=this._pendingIpcCalls[t.id];delete this._pendingIpcCalls[t.id],t.error?n.reject(t.error):n.resolve(t.reply)}getEventIndexingManager(){return this.eventIndexManager}setLanguage(e){this._ipcCall("setLanguage",e).catch(e=>{console.log("Failed to send setLanguage IPC to Electron"),console.error(e)})}getSSOCallbackUrl(e,t){const n=super.getSSOCallbackUrl(e,t);return n.protocol="riot",n.searchParams.set("riot-desktop-ssoid",this.ssoID),n}startSingleSignOn(e,t){super.startSingleSignOn(e,t),c.a.createTrackedDialog("Electron","SSO",l.a,{title:Object(s.a)("Go to your browser to complete Sign In"),description:g.a.createElement(d.a,null)})}_navigateForwardBack(e){this._ipcCall(e?"navigateBack":"navigateForward")}onKeyDown(e){let t=!1;switch(e.key){case p.a.SQUARE_BRACKET_LEFT:case p.a.SQUARE_BRACKET_RIGHT:!f||!e.metaKey||e.altKey||e.ctrlKey||e.shiftKey||(this._navigateForwardBack(e.key===p.a.SQUARE_BRACKET_LEFT),t=!0);break;case p.a.ARROW_LEFT:case p.a.ARROW_RIGHT:f||!e.altKey||e.metaKey||e.ctrlKey||e.shiftKey||(this._navigateForwardBack(e.key===p.a.ARROW_LEFT),t=!0)}return t}}}).call(this,n(17))},1172:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return p}));var a=n(466),i=n(8),o=n.n(i),s=n(39),r=n(34),c=n(55),l=n.n(c),d=n(1173),u=n.n(d);class p extends a.a{constructor(){super(),this.runningVersion=null,this.startUpdateCheck=this.startUpdateCheck.bind(this),this.stopUpdateCheck=this.stopUpdateCheck.bind(this)}getHumanReadableName(){return"Web Platform"}supportsNotifications(){return Boolean(e.Notification)}maySendNotifications(){return"granted"===e.Notification.permission}requestNotificationPermission(){return new Promise((function(t,n){e.Notification.requestPermission(e=>{t(e)})}))}displayNotification(t,n,a,i){const o={body:n,tag:"vector",silent:!0};a&&(o.icon=a);const r=new e.Notification(t,o);r.onclick=function(){s.a.dispatch({action:"view_room",room_id:i.roomId}),e.focus(),r.close()}}_getVersion(){return new Promise((function(e,t){o()({method:"GET",url:"version",qs:{cachebuster:Date.now()}},(n,a,i)=>{if(n||a.status<200||a.status>=300)return null===n&&(n={status:a.status}),void t(n);const o=i.trim();e(o)})}))}getAppVersion(){return null!==this.runningVersion?Promise.resolve(this.runningVersion):this._getVersion()}startUpdater(){this.pollForUpdate(),setInterval(this.pollForUpdate.bind(this),6e5)}async canSelfUpdate(){return!0}pollForUpdate(){return this._getVersion().then(e=>{if(null===this.runningVersion)this.runningVersion=e;else if(this.runningVersion!==e)return void s.a.dispatch({action:"new_version",currentVersion:this.runningVersion,newVersion:e});return{status:a.b.NOTAVAILABLE}},e=>(console.error("Failed to poll for update",e),{status:a.b.ERROR,detail:e.message||e.status?e.status.toString():"Unknown Error"}))}startUpdateCheck(){this.showUpdateCheck||(super.startUpdateCheck(),this.pollForUpdate().then(e=>{this.showUpdateCheck&&e&&s.a.dispatch({action:"check_updates",value:e})}))}installUpdate(){window.location.reload(!0)}getDefaultDeviceDisplayName(){const e=l.a.parse(window.location.href);e.protocol="",e.search="",e.hash="",e.pathname=e.pathname.replace(/\/$/,"");let t=e.format();t=t.replace(/^\/\//,"");const n=new u.a,a=n.getBrowser().name||"unknown browser";let i=n.getOS().name||"unknown OS";return"Mac OS"===i&&(i="macOS"),Object(r.a)("%(appName)s (%(browserName)s, %(osName)s)",{appName:t,browserName:a,osName:i})}screenCaptureErrorString(){return e.window&&"https:"===e.window.location.protocol?null:Object(r.a)("You need to be using HTTPS to place a screen-sharing call.")}reload(){window.location.reload(!1)}}}).call(this,n(17))},14:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n(8),i=n.n(a);async function o(e=""){""===e||e.endsWith("/")||(e+="/");const t=s("".concat(e,"config.").concat(document.domain,".json")),n=s(e+"config.json");try{const e=await t;if(0===Object.keys(e).length)throw new Error;return e}catch(e){return await n}}function s(e){return new Promise((function(t,n){i()({method:"GET",url:e,qs:{cachebuster:Date.now()}},(e,a,i)=>{try{if(e||a.status<200||a.status>=300)return a&&(404==a.status||0==a.status&&""==i)&&t({}),void n({err:e,response:a});t(JSON.parse(i))}catch(e){n({err:e})}})}))}},32:function(e,t,n){"use strict";n.r(t),n.d(t,"rageshakePromise",(function(){return f})),n.d(t,"preparePlatform",(function(){return w})),n.d(t,"loadConfig",(function(){return y})),n.d(t,"loadOlm",(function(){return b})),n.d(t,"loadLanguage",(function(){return _})),n.d(t,"loadSkin",(function(){return v})),n.d(t,"loadTheme",(function(){return E})),n.d(t,"loadApp",(function(){return k})),n.d(t,"showError",(function(){return I})),n.d(t,"showIncompatibleBrowser",(function(){return A})),n.d(t,"_t",(function(){return O}));var a=n(473),i=n(474),o=n.n(i),s=n(57),r=n(33),c=n(34),l=n(40),d=n(1169),u=n(1172),p=n(50),h=n(45),g=n(221),m=n(308),C=n(306);window.mxSendRageshake=function(e,t){void 0===t&&(t=!0),e&&e.trim()?Object(C.a)(h.a.get().bug_report_endpoint_url,{userText:e,sendLogs:t,progressCallback:console.log.bind(console)}).then(()=>{console.log("Bug report sent!")},e=>{console.error(e)}):console.error("Cannot send a rageshake without a message - please tell us what went wrong")};const f=function(){const e=m.d();return e.then(()=>{console.log("Initialised rageshake."),console.log("To fix line numbers in Chrome: Meatball menu → Settings → Blackboxing → Add /rageshake\\.js$"),window.addEventListener("beforeunload",e=>{console.log("riot-web closing"),m.b()}),m.a()},e=>{console.error("Failed to initialise rageshake: "+e)}),e}();function w(){if(window.ipcRenderer){console.log("Using Electron platform");const e=new d.a;p.a.set(e)}else console.log("Using Web platform"),p.a.set(new u.a)}async function y(){h.a.put(await p.a.get().getConfig()||{})}function b(){return o.a.init({locateFile:()=>a.a}).then(()=>{console.log("Using WebAssembly Olm")}).catch(e=>(console.log("Failed to load Olm: trying legacy version",e),new Promise((e,t)=>{const n=document.createElement("script");n.src="olm_legacy.js",n.onload=e,n.onerror=t,document.body.appendChild(n)}).then(()=>window.Olm.init()).then(()=>{console.log("Using legacy Olm")}).catch(e=>{console.log("Both WebAssembly and asm.js Olm failed!",e)})))}async function _(){const e=l.b.getValue("language",null,!0);let t=[];e?t=[e]:c.f().forEach(e=>{t.push(...c.g(e))});try{await c.k(t),document.documentElement.setAttribute("lang",c.d())}catch(e){console.error("Unable to set language",e)}}async function v(){console.log("Loading skin...");const[e,t]=await Promise.all([Promise.resolve().then(n.bind(null,36)),n.e(12).then(n.bind(null,1198))]);e.loadSkin(t),console.log("Skin loaded!")}async function E(){Object(g.d)()}async function k(e){const t=await n.e(11).then(n.bind(null,1188));window.matrixChat=s.render(await t.loadApp(e),document.getElementById("matrixchat"))}async function I(e,t){const a=(await n.e(6).then(n.bind(null,1189))).default;window.matrixChat=s.render(r.createElement(a,{title:e,messages:t}),document.getElementById("matrixchat"))}async function A(e){const t=(await n.e(5).then(n.bind(null,1190))).default;window.matrixChat=s.render(r.createElement(t,{onAccept:e}),document.getElementById("matrixchat"))}const O=c.a},466:function(e,t,n){"use strict";n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return d}));var a=n(1170),i=n(34),o=n(39),s=n(14),r=n(1171),c=n.n(r);const l={CHECKING:"CHECKING",ERROR:"ERROR",NOTAVAILABLE:"NOTAVAILABLE",DOWNLOADING:"DOWNLOADING",READY:"READY"};class d extends a.a{constructor(){super(),this.showUpdateCheck=!1,this.startUpdateCheck=this.startUpdateCheck.bind(this),this.stopUpdateCheck=this.stopUpdateCheck.bind(this)}async getConfig(){return Object(s.a)()}getHumanReadableName(){return"Vector Base Platform"}get favicon(){return this._favicon||(this._favicon=new c.a({animation:"none"})),this._favicon}_updateFavicon(){try{let e="#d00",t=this.notificationCount;this.errorDidOccur&&(t=t||"×",e="#f00");const n=()=>{this.favicon.badge(t,{bgColor:e})};n(),window.chrome&&n()}catch(e){console.warn("Failed to set badge count: ".concat(e.message))}}setNotificationCount(e){this.notificationCount!==e&&(super.setNotificationCount(e),this._updateFavicon())}setErrorStatus(e){this.errorDidOccur!==e&&(super.setErrorStatus(e),this._updateFavicon())}startUpdater(){}async canSelfUpdate(){return!1}startUpdateCheck(){this.showUpdateCheck=!0,o.a.dispatch({action:"check_updates",value:{status:l.CHECKING}})}stopUpdateCheck(){this.showUpdateCheck=!1,o.a.dispatch({action:"check_updates",value:!1})}getUpdateCheckStatusEnum(){return l}installUpdate(){}getDefaultDeviceDisplayName(){return Object(i.a)("Unknown device")}}}}]);
//# sourceMappingURL=init.js.map